<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Using S3 Storage :: Platform Foundation Bootcamp - RHOAI</title>
    <link rel="canonical" href="https://redhat-ai-services.github.io/rhoai-platform-foundation-bootcamp-instructions/modules/34_using_s3_storage.html">
    <meta name="generator" content="Antora 3.1.14">
<link rel="stylesheet" href="../_/css/site.css"><link rel="stylesheet" href="../_/css/site-extra.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">

<meta name="robots" content="all">
<link rel="icon" href="../_/img/favicon.ico" type="image/x-icon">
    <link rel="icon" href="https://demo.redhat.com/images/favicon.ico" type="image/x-icon">
  <script type="text/javascript" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar"  style="background-color: #131313 !important;">
    <div class="navbar-brand">
      <div style="display: flex; flex-direction:row; padding: 12px 32px; gap: 16px;">
     </div>
      <div class="navbar-item site-title" style="color: #fff !important;flex: 1;">Platform Foundation Bootcamp - RHOAI</div>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="modules" data-version="">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title" style="display: none;"><a href="index.html" class=" query-params-link">Navigation</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="01_welcome.html">Welcome and Introduction</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="05_environment_provisioning.html">Environment Provisioning</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">AI-Accelerator</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="20_ai-accelerator_review.html">Project Overview</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="07_installation.html">Bootstrap Installation</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="30_gitops_env_setup_dev_prod.html">Setup Dev &amp; Prod Environments</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">RHOAI Administration</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="32_dashboard_configuration.html">RHOAI Dashboard Configuration</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Notebooks</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="31_custom_notebook.html">Custom Notebook</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="09_remote_connect_notebook.html">Connect to Workbench Kernel</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Train, Store (S3), Deploy</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="33_model_training_car.html">Model Training</a>
  </li>
  <li class="nav-item is-current-page" data-depth="2">
    <a class="nav-link" href="34_using_s3_storage.html">Using S3 Storage</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="36_deploy_model.html">Deploy Model</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Data Science Pipelines</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="40_setup_pipeline_server.html">Setup Pipeline Server</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="41_introduction_to_kfp_pipelines.html">KFP Pipelines</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="kfp_elyra_differences.html">Comparison between Elyra and KFP</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="build_custom_runtime_image.html">Custom Runtime Image</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="introduction_to_elyra_pipelines.html">Elyra Pipelines</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="42_working_with_pipelines.html">Working with Pipelines</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="43_custom_runtime_image.html">Advanced Pipeline Customization</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Distributed Training</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="50_distributed_training.html">Ray Cluster</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Large Language Model [LLM]</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="60_llm_explore.html">Explore LLMs</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="70_rag_llm.html">RAG with LLM</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="composer_ai.html">Composer AI</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Monitoring Data Science Models</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="80_trustyai_overview.html">TrustyAI Overview</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="81_llm_evaluation.html">Evaluating Large Language Models</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Disconnected Environment</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="disconnected_install.html">RHOAI on Disconnected Environment</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">GPU as a Service</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="90_environment_provisioning.html">Provisioning a GPU Environment with NVIDIA A10G Tensor Core GPU</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="91_gpu_as_a_service_intro.html">Introduction: GPU as a Service with GPU slicing and Kueue</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="92_nvidia_gpu_operator.html">Configuring NVIDIA GPU Time-Slicing on OpenShift</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="93_kueue_setup.html">Red Hat build of Kueue Operator Setup</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="94_kueue_gpu_pricing_tier.html">Implementing GPU Pricing Tiers with Kueue</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="95_kueue_fair_sharing.html">Advanced GPU Quota Management and Preemption with Kueue</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Model-as-a-Service</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="100_maas_intro.html">Introduction</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="101_maas_bootstrap.html">Environment Bootstrap</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="102_maas_as_developer.html">Using MaaS as Developer</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="103_maas_as_platform_engineer.html">Configure a new model</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="104_maas_monitor.html">Monitor usage</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Agentic AI with Llama Stack</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="97_agentic_ai_llama_stack_introduction.html">Introduction &amp; Setup</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="98_agentic_ai_llama_stack_notebook_agents.html">Agentic AI Agents with Llama Stack Clients</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="99_agentic_ai_llama_stack_playground.html">Llama Stack Playground</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="#99_useful_tips.adoc">Useful Tips</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="#97_syncing_fork.adoc">Syncing Forked Project</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
  </div>
  <ul class="components">
    <li class="component is-current">
      <span class="title">Navigation</span>
      <ul class="versions">
        <li class="version is-current">
          <a href="index.html">default</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="01_welcome.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li>Train, Store (S3), Deploy</li>
    <li><a href="34_using_s3_storage.html">Using S3 Storage</a></li>
  </ul>
</nav>
</div>
  <div class="content">
<article class="doc">
<h1 class="page">Using S3 Storage</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>In this module you will set up some S3 based storage in the OpenShift cluster, and the utilize the Python package called <a href="https://pypi.org/project/boto3/">Boto3</a> to explore the existing S3 based storage configuration.</p>
</div>
<div class="paragraph">
<p>We will also set up scripts to automate uploading the ML models to the locations required by the pipelines in subsequent modules.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_what_is_s3_storage"><a class="anchor" href="#_what_is_s3_storage"></a>What is S3 Storage?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Amazon Simple Storage Service (S3) is a service offered by Amazon Web Services (AWS) that provides object storage through a web service interface.</p>
</div>
<div class="paragraph">
<p>This lab uses <a href="https://github.com/minio/minio">MinIO</a> to implement S3 storage, which is High Performance Object Storage released under GNU Affero General Public License v3.0. MinIO is API compatible with Amazon S3 cloud storage service. Use MinIO to build high performance infrastructure for machine learning, analytics and application data workloads.</p>
</div>
<div class="paragraph">
<p>For more information about S3:
* AWS documentation: <a href="https://docs.aws.amazon.com/AmazonS3/latest/userguide/Welcome.html">What is Amazon S3?</a>
* Wikipedia: <a href="https://en.wikipedia.org/wiki/Amazon_S3">Amazon S3</a></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_adding_minio_to_the_cluster"><a class="anchor" href="#_adding_minio_to_the_cluster"></a>Adding MinIO to the Cluster</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In this section we will add MinIO S3 storage operator to our dev OpenShift cluster configuration project so Argo can deploy it.</p>
</div>
<div class="paragraph">
<p>If you need a reference, the ai-accelerator project has MinIO set up in under the <code>tenants/ai-examples folder</code>.</p>
</div>
<div class="sect2">
<h3 id="_set_up_minio"><a class="anchor" href="#_set_up_minio"></a>Set up MinIO</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Create a namespace resource called <code>object-datastore.yaml</code> in the <code>tenants/parasol-insurance/namespaces/base</code>. This should be an OpenShift Namespace resource named <code>object-datastore</code>.</p>
<details>
<summary class="title">Solution</summary>
<div class="content">
<div class="listingblock console-input">
<div class="title">tenants/parasol-insurance/namespaces/base/object-datastore.yaml</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: v1
kind: Namespace
metadata:
  name: object-datastore
  labels:
    kubernetes.io/metadata.name: object-datastore</code></pre>
</div>
</div>
</div>
</details>
</li>
<li>
<p>Modify the <code>tenants/parasol-insurance/namespaces/base/kustomization.yaml</code> file to include the new namespace resource:</p>
<details>
<summary class="title">Solution</summary>
<div class="content">
<div class="listingblock console-input">
<div class="title">tenants/parasol-insurance/namespaces/base/kustomization.yaml</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

resources:
  - parasol-insurance.yaml
  - object-datastore.yaml</code></pre>
</div>
</div>
</div>
</details>
</li>
<li>
<p>Create a new directory named <code>minio</code> in the <code>tenants/parasol-insurance</code> directory.</p>
</li>
<li>
<p>Create the <code>base</code> and <code>overlays</code> directories inside the <code>minio</code> directory.</p>
</li>
<li>
<p>Create a file named <code>kustomization.yaml</code> inside the <code>minio/base</code> directory. This should point to the <code>minio/overlays/default</code> folder.</p>
<details>
<summary class="title">Solution</summary>
<div class="content">
<div class="listingblock console-input">
<div class="title">tenants/parasol-insurance/minio/base/kustomization.yaml</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

namespace: object-datastore

resources:
  - ../../../../components/apps/minio/overlays/default</code></pre>
</div>
</div>
</div>
</details>
</li>
<li>
<p>Add the overlay for <code>parasol-insurance-dev</code>. This should be a <code>kustomization.yaml</code> file pointing to the minio&#8217;s base directory for <code>parasol-insurance-dev</code>.</p>
<details>
<summary class="title">Solution</summary>
<div class="content">
<div class="listingblock console-input">
<div class="title">tenants/parasol-insurance/minio/overlays/parasol-insurance-dev/kustomization.yaml</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

resources:
  - ../../base</code></pre>
</div>
</div>
</div>
</details>
</li>
<li>
<p>(Optional) Create for prod overlay. Add the overlay for <code>parasol-insurance-prod</code>. This should be a <code>kustomization.yaml</code> file pointing to the overlay directory for <code>parasol-insurance-prod</code>.</p>
<details>
<summary class="title">Solution</summary>
<div class="content">
<div class="listingblock console-input">
<div class="title">tenants/parasol-insurance/minio/overlays/parasol-insurance-prod/kustomization.yaml</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

resources:
  - ../../base</code></pre>
</div>
</div>
</div>
</details>
</li>
</ol>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The same content will work for both overlays (dev and prod)</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Commit your changes to your fork of ai-accelerator project. Wait for ArgoCD to sync and deploy MinIO.</p>
</div>
<div class="paragraph">
<p>You should find your minio resource in the <em><strong>object-datastore</strong></em> namespace.</p>
</div>
<div class="paragraph">
<p>The <strong>minio-ui</strong> route can be found in <em><strong>object-datastore</strong></em> namespace under <em><strong>Routes</strong></em>. Open this in a new tab and log in with <code>minio:minio123</code>.</p>
</div>
<div class="paragraph">
<p>Explore the S3 storage.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>To check your work please refer to <a href="https://github.com/redhat-ai-services/ai-accelerator-qa/tree/2.16-parasol-dev-prod">This Branch</a></p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_explore_s3_with_boto3"><a class="anchor" href="#_explore_s3_with_boto3"></a>Explore S3 with Boto3</h2>
<div class="sectionbody">
<div class="paragraph">
<p>We have previously used a custom workbench to explore how to train a model. Now we will use a standard workbench to explore the S3 storage using the Boto3 Python package.</p>
</div>
<div class="sect2">
<h3 id="_create_a_standard_workbench"><a class="anchor" href="#_create_a_standard_workbench"></a>Create a standard workbench</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Navigate to RHOAI dashboard, and stop the <code>custom-workbench</code>.</p>
</li>
<li>
<p>In your ai-accelerator fork project, create a directory named <code>standard-workbench</code> in the <code>tenants/parasol-insurance</code> directory.</p>
</li>
<li>
<p>Create the <code>base</code> and <code>overlays</code> directories inside the <code>standard-workbench</code> directory.</p>
</li>
<li>
<p>Create a <code>kustomization.yaml</code> file inside the <code>standard-workbench/base</code> directory. This should have resources for the <strong>workbench pvc, data connection, and workbench notebook</strong>. Remember to add the`parasol-insurance` namespace.</p>
<div class="listingblock console-input">
<div class="title">tenants/parasol-insurance/standard-workbench/base/kustomization.yaml</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

resources:
  - &lt;add resources here&gt;</code></pre>
</div>
</div>
<details>
<summary class="title">Solution</summary>
<div class="content">
<div class="listingblock console-input">
<div class="title">tenants/parasol-insurance/standard-workbench/base/kustomization.yaml</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization
namespace: parasol-insurance

resources:
  - standard-workbench-pvc.yaml
  - minio-data-connection.yaml
  - standard-workbench-notebook.yaml</code></pre>
</div>
</div>
</div>
</details>
</li>
<li>
<p>Create a file named <code>standard-workbench-pvc.yaml</code> inside the <code>standard-workbench/base</code> directory. This resource should be a OpenShift PVC resource with <strong>40Gi</strong> of storage.</p>
<details>
<summary class="title">Solution</summary>
<div class="content">
<div class="listingblock console-input">
<div class="title">tenants/parasol-insurance/standard-workbench/base/standard-workbench-pvc.yaml</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">kind: PersistentVolumeClaim
apiVersion: v1
metadata:
  name: standard-workbench
  namespace: parasol-insurance
spec:
  accessModes:
    - ReadWriteOnce
  resources:
    requests:
      storage: 40Gi
  volumeMode: Filesystem</code></pre>
</div>
</div>
</div>
</details>
</li>
<li>
<p>Create a secret named <code>minio-data-connection.yaml</code> inside the <code>standard-workbench/base</code> directory. This shoud have the minio S3 connection details. This should show up in the Data Connection tab of the Data Science Project if set up correctly.</p>
<div class="listingblock console-input">
<div class="title">tenants/parasol-insurance/standard-workbench/base/minio-data-connection.yaml</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">kind: Secret
apiVersion: v1
metadata:
  name: minio-data-connection
  labels:
    &lt;add RHOAI Dashbaord labels here&gt;
  annotations:
    opendatahub.io/connection-type: s3
    openshift.io/display-name: minio-data-connection
    argocd.argoproj.io/sync-wave: "-100"
stringData:
  &lt;add Keys and Values here&gt;
type: Opaque</code></pre>
</div>
</div>
<details>
<summary class="title">Solution</summary>
<div class="content">
<div class="listingblock console-input">
<div class="title">tenants/parasol-insurance/standard-workbench/base/minio-data-connection.yaml</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">kind: Secret
apiVersion: v1
metadata:
  name: minio-data-connection
  labels:
    opendatahub.io/dashboard: 'true'
    opendatahub.io/managed: 'true'
  annotations:
    opendatahub.io/connection-type: s3
    openshift.io/display-name: minio-data-connection
    argocd.argoproj.io/sync-wave: "-100"
stringData:
  AWS_ACCESS_KEY_ID: minio
  AWS_S3_ENDPOINT: http://minio.object-datastore.svc.cluster.local:9000
  AWS_SECRET_ACCESS_KEY: minio123
  AWS_DEFAULT_REGION: east-1
type: Opaque</code></pre>
</div>
</div>
</div>
</details>
</li>
<li>
<p>Create a file named <code>standard-workbench-notebook.yaml</code> inside the <code>standard-workbench/base</code> directory. This yaml should be a <code>Notebook</code> RHOAI resource with the <code>s2i-generic-data-science-notebook:2024.2</code> image. It should reference the PVC storage and the data connection resource that we created earlier. TIP: You can find an example/reference Notebook resource by using the OpenShift search.</p>
<details>
<summary class="title">Solution</summary>
<div class="content">
<div class="listingblock console-input">
<div class="title">tenants/parasol-insurance/standard-workbench/base/standard-workbench-notebook.yaml</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: kubeflow.org/v1
kind: Notebook
metadata:
  annotations:
    notebooks.opendatahub.io/inject-oauth: "true"
    opendatahub.io/image-display-name: Standard Data Science
    notebooks.opendatahub.io/oauth-logout-url: ""
    opendatahub.io/accelerator-name: ""
    openshift.io/description: ""
    openshift.io/display-name: standard-workbench
    notebooks.opendatahub.io/last-image-selection: "s2i-generic-data-science-notebook:2024.2"
    argocd.argoproj.io/sync-options: ServerSideApply=true
  name: standard-workbench
  namespace: parasol-insurance
spec:
  template:
    spec:
      affinity: {}
      containers:
        - name: standard-workbench
          image: "image-registry.openshift-image-registry.svc:5000/redhat-ods-applications/s2i-generic-data-science-notebook:2024.2"
          resources:
            limits:
              cpu: "2"
              memory: 8Gi
            requests:
              cpu: "1"
              memory: 8Gi
          readinessProbe:
            failureThreshold: 3
            httpGet:
              path: /notebook/parasol-insurance/standard-workbench/api
              port: notebook-port
              scheme: HTTP
            initialDelaySeconds: 10
            periodSeconds: 5
            successThreshold: 1
            timeoutSeconds: 1
          livenessProbe:
            failureThreshold: 3
            httpGet:
              path: /notebook/parasol-insurance/standard-workbench/api
              port: notebook-port
              scheme: HTTP
            initialDelaySeconds: 10
            periodSeconds: 5
            successThreshold: 1
            timeoutSeconds: 1
          env:
            - name: NOTEBOOK_ARGS
              value: |-
                --ServerApp.port=8888
                --ServerApp.token=''
                --ServerApp.password=''
                --ServerApp.base_url=/notebook/parasol-insurance/standard-workbench
                --ServerApp.quit_button=False
                --ServerApp.tornado_settings={"user":"user1","hub_host":"","hub_prefix":"/projects/parasol-insurance"}
            - name: JUPYTER_IMAGE
              value: 'image-registry.openshift-image-registry.svc:5000/redhat-ods-applications/s2i-generic-data-science-notebook:2024.2'
            - name: REQUESTS_CA_BUNDLE
              value: /etc/pki/tls/custom-certs/ca-bundle.crt
            - name: SSL_CERT_FILE
              value: /etc/pki/tls/custom-certs/ca-bundle.crt
            - name: PIPELINES_SSL_SA_CERTS
              value: /etc/pki/tls/custom-certs/ca-bundle.crt
            - name: GIT_SSL_CAINFO
              value: /etc/pki/tls/custom-certs/ca-bundle.crt
            - name: PIP_CERT
              value: /etc/pki/tls/custom-certs/ca-bundle.crt
          ports:
            - containerPort: 8888
              name: notebook-port
              protocol: TCP
          imagePullPolicy: Always
          volumeMounts:
            - mountPath: /opt/app-root/src
              name: standard-workbench
            - mountPath: /dev/shm
              name: shm
            - mountPath: /etc/pki/tls/custom-certs/ca-bundle.crt
              name: trusted-ca
              readOnly: true
              subPath: ca-bundle.crt
            - mountPath: /etc/oauth/config
              name: oauth-config
            - mountPath: /etc/tls/private
              name: tls-certificates
          workingDir: /opt/app-root/src
          envFrom:
            - secretRef:
                name: minio-data-connection
      enableServiceLinks: false
      serviceAccountName: standard-workbench
      volumes:
        - name: standard-workbench
          persistentVolumeClaim:
            claimName: standard-workbench
        - emptyDir:
            medium: Memory
          name: shm
        - configMap:
            items:
              - key: ca-bundle.crt
                path: ca-bundle.crt
            name: workbench-trusted-ca-bundle
            optional: true
          name: trusted-ca
        - name: oauth-config
          secret:
            defaultMode: 420
            secretName: test-ssl-oauth-config
        - name: tls-certificates
          secret:
            defaultMode: 420
            secretName: standard-workbench-tls</code></pre>
</div>
</div>
</div>
</details>
</li>
<li>
<p>Create a directory named <code>parasol-insurance-dev</code> under the <code>standard-workbench/overlays</code> directory.</p>
</li>
<li>
<p>Create a <code>kustomization.yaml</code> file inside the <code>standard-workbench/overlays/parasol-insurance-dev</code> directory. This should point to the base folder of the <code>parsol-insurance-dev</code> directory:</p>
<details>
<summary class="title">Solution</summary>
<div class="content">
<div class="listingblock console-input">
<div class="title">tenants/parasol-insurance/standard-workbench/overlays/parasol-insurance-dev/kustomization.yaml</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

resources:
  - ../../base</code></pre>
</div>
</div>
</div>
</details>
</li>
<li>
<p>Push the changes to your fork, and wait for the Argo synchronization to complete.</p>
</li>
<li>
<p>Navigate to RHOAI dashboard, and you should see an <code>Standard Workbench</code> available in the <code>Workbenches</code> tab.</p>
<div class="imageblock bordershadow">
<div class="content">
<img src="_images/standard-workbench.png" alt="Standard workbench">
</div>
</div>
</li>
<li>
<p>(Optional) Add an overlay for the <code>parasol-insurance-prod</code> environment.</p>
</li>
</ol>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>To check your work please refer to <a href="https://github.com/redhat-ai-services/ai-accelerator-qa/tree/2.16-parasol-dev-prod">This Branch</a></p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_explore_s3_in_rhoai_workbench"><a class="anchor" href="#_explore_s3_in_rhoai_workbench"></a>Explore S3 in RHOAI Workbench</h2>
<div class="sectionbody">
<div class="paragraph">
<p><a href="https://pypi.org/project/boto3/">Boto3</a> is a commonly used Python package, which is the AWS SDK for communicating with S3 storage providers. It allows you to directly interact with AWS services such as S3, EC2, and more.</p>
</div>
<div class="paragraph">
<p>Lets create some Python code in a Jupyter notebook to interact with our S3 storage:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Go to RHOAI Dashboard and go to the <em><strong>parasol-insurance</strong></em> Data Science Project.</p>
<div class="imageblock bordershadow">
<div class="content">
<img src="_images/standard-workbench.png" alt="Standard workbench">
</div>
</div>
</li>
<li>
<p>As you can see there is a workbench running named <em>standard-workbench</em>.</p>
</li>
<li>
<p>Use the kebab menu and select <code>Edit workbench</code>. The <em>Environment Variables</em> section is empty, while <em>Connections</em> section shows already attached <code>minio-data-connection</code> of S3 type.</p>
<div class="imageblock bordershadow">
<div class="content">
<img src="_images/Workbench_Edit_rhoai2_19_conn_env_vars.png" alt="Workbench Edit rhoai2 19 conn env vars">
</div>
</div>
</li>
<li>
<p>Use the kebab menu of that connection and select <code>Edit</code> to see all connection details (i.e. <code>access key</code>, <code>Endpoint</code>, etc)</p>
<div class="imageblock bordershadow">
<div class="content">
<img src="_images/Workbench_Edit_rhoai2_19_conn_details.png" alt="Workbench Edit rhoai2 19 conn details">
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>User interface of older RHOAI versions, was showing S3 connection details directly in <em>Environment Variables</em> section.
Starting with RHOAI v2.19, these details can be found in a dedicated pop-up UI behind <code>Edit</code> function like described above.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Launch the workbench and wait for the Jupyter notebook to start up.</p>
</li>
<li>
<p>Create a new Notebook.</p>
</li>
<li>
<p>In a new cell, add and run the content below to install the <code>boto3</code> and <code>ultralytics</code> packages using pip.</p>
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-python hljs" data-lang="python">!pip install boto3 ultralytics</code></pre>
</div>
</div>
</li>
<li>
<p>In a new cell, add and configure the connection to MinIO S3. Make sure to reference the S3 connection details.</p>
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-python hljs" data-lang="python">## &lt;Add Imports here&gt;
from botocore.client import Config

# Configuration
## &lt;Add minio url here from environment variables&gt;
## &lt;Add the access key from environment variables&gt;
## &lt;Add the secret key from environment variables&gt;

# Setting up the MinIO client
s3 = boto3.client(
    's3',
    endpoint_url=minio_url,
    aws_access_key_id=access_key,
    aws_secret_access_key=secret_key,
    config=Config(signature_version='s3v4'),
)</code></pre>
</div>
</div>
<details>
<summary class="title">Solution</summary>
<div class="content">
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-python hljs" data-lang="python">import os
import boto3
from botocore.client import Config

# Configuration
minio_url = os.environ["AWS_S3_ENDPOINT"]
access_key = os.environ["AWS_ACCESS_KEY_ID"]
secret_key = os.environ["AWS_SECRET_ACCESS_KEY"]

# Setting up the MinIO client
s3 = boto3.client(
    's3',
    endpoint_url=minio_url,
    aws_access_key_id=access_key,
    aws_secret_access_key=secret_key,
    config=Config(signature_version='s3v4'),
)</code></pre>
</div>
</div>
</div>
</details>
</li>
<li>
<p>Using the boto3.client variable from the previous step, define a function to list the current buckets in a new cell. Name this function <code>get_minio_buckets</code></p>
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-python hljs" data-lang="python"># Function to get MinIO server bucket info
# Print the list of buckets in S3
def get_minio_buckets():
    # This function retrieves the list of buckets as an example.


get_minio_buckets()</code></pre>
</div>
</div>
<details>
<summary class="title">Solution</summary>
<div class="content">
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-python hljs" data-lang="python"># Function to get MinIO server info
def get_minio_buckets():
    # This function retrieves the list of buckets as an example.
    # MinIO admin info is not directly supported by boto3; you'd need to use MinIO's admin API.
    response = s3.list_buckets()
    print("Buckets:")
    for bucket in response['Buckets']:
        print(f'  {bucket["Name"]}')

get_minio_buckets()</code></pre>
</div>
</div>
</div>
</details>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>We currently have no buckets in the S3 storage. We will create a bucket and upload a file to it.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Using the boto3.client variable, create a function to create a new bucket in S3 storage in a new cell. Name it <code>create_minio_bucket</code> with <code>bucket_name</code> as an input parameter.</p>
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-python hljs" data-lang="python"># Function to create a bucket
def create_minio_bucket(bucket_name):
    try:
        ## add functionality here

    except Exception as e:
        print(f"Error creating bucket '{bucket_name}': {e}")</code></pre>
</div>
</div>
<details>
<summary class="title">Solution</summary>
<div class="content">
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-python hljs" data-lang="python"># Function to create a bucket
def create_minio_bucket(bucket_name):
    try:
        s3.create_bucket(Bucket=bucket_name)
        print(f"Bucket '{bucket_name}' successfully created.")
    except Exception as e:
        print(f"Error creating bucket '{bucket_name}': {e}")</code></pre>
</div>
</div>
</div>
</details>
</li>
<li>
<p>In a new cell, Use the fuctions that you just created to create 2 buckets: <code>models</code> and <code>pipelines</code>. Use the <code>get_minio_buckets</code> function you created to view the newly created buckets.</p>
<details>
<summary class="title">Solution</summary>
<div class="content">
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-python hljs" data-lang="python">create_minio_bucket('models')
create_minio_bucket('pipelines')
get_minio_buckets()</code></pre>
</div>
</div>
</div>
</details>
</li>
<li>
<p>Using the boto3.client variable, create a function to upload a file to a bucket. This function should be named <code>upload_file</code> and should take 3 input parameters: <code>file_path</code>, <code>bucket_name</code>, and <code>object_name</code>.</p>
<details>
<summary class="title">Solution</summary>
<div class="content">
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-python hljs" data-lang="python"># Function to upload a file to a bucket
def upload_file(file_path, bucket_name, object_name):
    try:
        s3.upload_file(file_path, bucket_name, object_name)
        print(f"File '{file_path}' successfully uploaded to bucket '{bucket_name}' as '{object_name}'.")
    except Exception as e:
        print(f"Error uploading file '{file_path}' to bucket '{bucket_name}': {e}")</code></pre>
</div>
</div>
</div>
</details>
</li>
<li>
<p>Download the <code>accident_detect.onnx</code> model and upload the file to S3 storage under the <code>models</code> bucket. The onnx file should be stored under the path: <code>weights/accident_detect.onnx</code>. You can use this snippet to download the onnx model:</p>
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-python hljs" data-lang="python"># Download the model
from ultralytics import YOLO
model = YOLO("https://rhods-public.s3.amazonaws.com/demo-models/ic-models/accident/accident_detect.onnx", task="detect")</code></pre>
</div>
</div>
<details>
<summary class="title">Solution</summary>
<div class="content">
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-python hljs" data-lang="python"># Download the model
from ultralytics import YOLO
model = YOLO("https://rhods-public.s3.amazonaws.com/demo-models/ic-models/accident/accident_detect.onnx", task="detect")
# Upload the file
upload_file('weights/accident_detect.onnx', 'models', 'accident_model/accident_detect.onnx')</code></pre>
</div>
</div>
</div>
</details>
</li>
<li>
<p>Create a function to view the contents of the bucket. The function should be named <code>get_minio_content</code> and should have an input parameter of <code>bucket</code>.</p>
<details>
<summary class="title">Solution</summary>
<div class="content">
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-python hljs" data-lang="python"># Function to get the content in the bucket
def get_minio_content(bucket):
    # This function retrieves the content in the bucket
    # MinIO admin info is not directly supported by boto3; you'd need to use MinIO's admin API.
    print("Content:")
    for key in s3.list_objects(Bucket=bucket)['Contents']:
        print(f'  {key["Key"]}')</code></pre>
</div>
</div>
</div>
</details>
</li>
<li>
<p>Call the newly created function to view the file contents of the <code>models</code> bucket.</p>
<details>
<summary class="title">Solution</summary>
<div class="content">
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-python hljs" data-lang="python">get_minio_content('models')</code></pre>
</div>
</div>
</div>
</details>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_questions_for_further_consideration"><a class="anchor" href="#_questions_for_further_consideration"></a>Questions for Further Consideration</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Additional questions that could be discussed for this topic:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>What other tools exist for interacting with S3? Hint, <a href="https://s3tools.org/s3cmd">s3cmd</a> is another quite popular S3 CLI tool.</p>
</li>
<li>
<p>Could a shortcut to the MinIO Console be added to OpenShift? Hint, see the OpenShift <code>ConsoleLink</code> API, <a href="https://github.com/redhat-na-ssa/demo-lab-config/blob/main/demo/run-mlflow/link-minio.yaml">here&#8217;s an example</a>.</p>
</li>
<li>
<p>What&#8217;s the maximum size of an object, such as a ML model that can be stored in S3?</p>
</li>
</ul>
</div>
</div>
</div>
</article>
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
  </div>
</main>
</div>
<footer class="footer">
  <a href="https://demo.redhat.com" target="_blank" class="poweredBy"><p>Powered by</p><div class="labInfo_poweredBy" style="display: block; width: 260px;"><svg class="labInfo_poweredByLogo" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1508.5 178.739"><g fill="#111"><path d="M316.6 63.2v-56H342a21.279 21.279 0 0 1 7.8 1.3 18.111 18.111 0 0 1 5.9 3.5 15.577 15.577 0 0 1 5 11.8 15.051 15.051 0 0 1-3.1 9.5 16.836 16.836 0 0 1-8.4 5.8l12.5 24.1h-9.3l-11.6-23H325v23Zm24.7-48.6H325v18.7h16.3q5.25 0 8.1-2.7a8.7 8.7 0 0 0 2.8-6.6 8.7 8.7 0 0 0-2.8-6.6c-1.8-1.9-4.5-2.8-8.1-2.8ZM364.1 42.8a20.674 20.674 0 0 1 1.6-8.2 20.288 20.288 0 0 1 4.3-6.7 19.92 19.92 0 0 1 6.5-4.5 19.718 19.718 0 0 1 8-1.6 18.463 18.463 0 0 1 7.8 1.6 18.677 18.677 0 0 1 6.2 4.5 20.927 20.927 0 0 1 4.1 6.8 23.2 23.2 0 0 1 1.5 8.4v2.3H372a13.822 13.822 0 0 0 4.6 8.4 13.6 13.6 0 0 0 9.1 3.3 15.553 15.553 0 0 0 5.7-1 12.858 12.858 0 0 0 4.6-2.6l5.1 5a25.983 25.983 0 0 1-7.4 4.1 24.69 24.69 0 0 1-8.4 1.3 21.306 21.306 0 0 1-8.4-1.6 22.763 22.763 0 0 1-6.8-4.4 20.788 20.788 0 0 1-4.5-6.7 23.2 23.2 0 0 1-1.5-8.4Zm20.2-14.2a11.527 11.527 0 0 0-8 3 13.046 13.046 0 0 0-4.2 7.8h24.2a13.091 13.091 0 0 0-4.2-7.8 11.106 11.106 0 0 0-7.8-3ZM443.1 63.2v-3.8a19.448 19.448 0 0 1-5.8 3.3 18.924 18.924 0 0 1-6.7 1.2 19.824 19.824 0 0 1-14.6-6.1 22.268 22.268 0 0 1-4.4-6.7 21.812 21.812 0 0 1 0-16.4A20.534 20.534 0 0 1 416 28a19.335 19.335 0 0 1 6.6-4.5 20.334 20.334 0 0 1 8.2-1.6 20.7 20.7 0 0 1 6.6 1 19.415 19.415 0 0 1 5.7 3V7.2l8-1.8v57.8Zm-25.2-20.4a13.718 13.718 0 0 0 4 10.1 13.45 13.45 0 0 0 9.8 4.1 14.956 14.956 0 0 0 6.4-1.3 15.954 15.954 0 0 0 4.9-3.6V33.6a14.988 14.988 0 0 0-4.9-3.5 15.271 15.271 0 0 0-6.4-1.3 13.423 13.423 0 0 0-9.9 4 13.806 13.806 0 0 0-3.9 10ZM478.1 63.2v-56h8.4v24h29.8v-24h8.4v56h-8.4V38.8h-29.8v24.4ZM547.2 64a16.483 16.483 0 0 1-10.8-3.5 11.037 11.037 0 0 1-4.2-8.9 10.375 10.375 0 0 1 4.7-9.2 20.76 20.76 0 0 1 11.8-3.2 27.841 27.841 0 0 1 5.8.6 27.374 27.374 0 0 1 5.3 1.6v-4.3a8.143 8.143 0 0 0-2.6-6.5 11.452 11.452 0 0 0-7.4-2.2 20.788 20.788 0 0 0-6 .9 34.616 34.616 0 0 0-6.6 2.6l-3-6a54.169 54.169 0 0 1 8.4-3.1 33.18 33.18 0 0 1 8.3-1.1c5.2 0 9.3 1.3 12.2 3.8s4.4 6.1 4.4 10.8v27h-7.8v-3.5a19.441 19.441 0 0 1-5.8 3.2 23.54 23.54 0 0 1-6.7 1Zm-7.3-12.6a5.646 5.646 0 0 0 2.6 4.8 11.193 11.193 0 0 0 6.6 1.8 16.256 16.256 0 0 0 5.9-1 14.449 14.449 0 0 0 4.9-2.9V47a19.778 19.778 0 0 0-4.8-1.8 24.933 24.933 0 0 0-5.7-.6 11.859 11.859 0 0 0-6.8 1.8 5.728 5.728 0 0 0-2.7 5ZM580.6 53.2v-24H572v-6.7h8.6V12.1l7.9-1.9v12.3h12v6.7h-12v22.1a5.94 5.94 0 0 0 1.4 4.4c.9.9 2.5 1.3 4.6 1.3a23.637 23.637 0 0 0 3-.2 10.857 10.857 0 0 0 2.8-.8v6.7a19.28 19.28 0 0 1-3.8.9 27.484 27.484 0 0 1-3.8.3c-3.9 0-7-.9-9-2.8-2-1.7-3.1-4.4-3.1-7.9Z"></path></g><path d="M127 90.2c12.5 0 30.6-2.6 30.6-17.5a12.678 12.678 0 0 0-.3-3.4L149.8 37c-1.7-7.1-3.2-10.3-15.7-16.6-9.7-5-30.8-13.1-37.1-13.1-5.8 0-7.5 7.5-14.4 7.5-6.7 0-11.6-5.6-17.9-5.6-6 0-9.9 4.1-12.9 12.5 0 0-8.4 23.7-9.5 27.2a4.216 4.216 0 0 0-.3 1.9c0 9.2 36.3 39.4 85 39.4Zm32.5-11.4c1.7 8.2 1.7 9.1 1.7 10.1 0 14-15.7 21.8-36.4 21.8-46.8 0-87.7-27.4-87.7-45.5a17.535 17.535 0 0 1 1.5-7.3C21.8 58.8 0 61.8 0 81c0 31.5 74.6 70.3 133.7 70.3 45.3 0 56.7-20.5 56.7-36.6-.1-12.8-11-27.3-30.9-35.9Z" fill="#e00"></path><path d="M159.5 78.8c1.7 8.2 1.7 9.1 1.7 10.1 0 14-15.7 21.8-36.4 21.8-46.8 0-87.7-27.4-87.7-45.5a17.535 17.535 0 0 1 1.5-7.3l3.7-9.1a4.877 4.877 0 0 0-.3 2c0 9.2 36.3 39.4 85 39.4 12.5 0 30.6-2.6 30.6-17.5a12.678 12.678 0 0 0-.3-3.4Z"></path><path d="M253.5 158.7a2.22 2.22 0 0 1-2.2-2.2V2.2a2.2 2.2 0 0 1 4.4 0v154.2a2.242 2.242 0 0 1-2.2 2.3Z" fill="#111"></path><text data-name="Demo Platform" transform="translate(1186 149)" fill="#111" font-size="82" font-family="'RedHatDisplay', 'Overpass', overpass, helvetica, arial, sans-serif" font-weight="700"><tspan x="-877.892" y="0">Demo Platform</tspan></text></svg></div></a>
</footer>
<script src="../_/js/vendor/clipboard.js"></script>
<script src="../_/js/site.js"></script>
<script async src="../_/js/vendor/highlight.js"></script>
  </body>
</html>
